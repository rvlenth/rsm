<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rsm">
<title>Response-surface illustration • rsm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Response-surface illustration">
<meta property="og:description" content="rsm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rsm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.10.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/article-JSS.html">Response-Surface Methods in R, Using rsm</a>
    <a class="dropdown-item" href="../articles/illus.html">Response-surface illustration</a>
    <a class="dropdown-item" href="../articles/plots.html">Surface Plots in the rsm Package</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="https://github.com/rvlenth/rsm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Response-surface illustration</h1>
                        <h4 data-toc-skip class="author">rsm package,
Version 2.10.5</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rvlenth/rsm/blob/HEAD/vignettes/illus.rmd"><code>vignettes/illus.rmd</code></a></small>
      <div class="d-none name"><code>illus.rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="abstract">Abstract<a class="anchor" aria-label="anchor" href="#abstract"></a>
</h3>
<p>In this vignette, we give an illustration, using simulated data, of a
sequential-experimentation process to optimize a response surface. I
hope that this is helpful for understanding both how to use the
<strong>rsm</strong> package and RSM methodology in general.</p>
</div>
<div class="section level2">
<h2 id="the-scenario">The scenario<a class="anchor" aria-label="anchor" href="#the-scenario"></a>
</h2>
<p>We will use simulated data from a hypothetical baking experiment. Our
goal is to find the optimal amounts of flour, butter, and sugar in a
recipe. The response variable is some rating of the texture and flavor
of the product. The baking temperature, procedures, equipment, and
operating environment will be held constant.</p>
</div>
<div class="section level2">
<h2 id="initial-experiment">Initial experiment<a class="anchor" aria-label="anchor" href="#initial-experiment"></a>
</h2>
<p>Our current recipe calls for 1 cup of flour, 0.50 cups of sugar, and
0.25 cups of butter. Our initial experiment will center at this recipe,
and we will vary each ingredient by <span class="math inline">\(\pm0.1\)</span> cup. Let’s start with a minimal
first-order experiment, a half-fraction of a <span class="math inline">\(2^3\)</span> design plus 4 center points. This is
a total of 8 experimental runs, which is quite enough given the labor
involved. The philosophy of RSM is to do minimal experiments that can be
augmented later if necessary if more detail is needed. We’ll generate
and randomize the experiment using <code>cube</code>, in terms of coded
variables <span class="math inline">\(x_1,x_2,x_3\)</span>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rvlenth/rsm">rsm</a></span><span class="op">)</span></span>
<span><span class="va">expt1</span> <span class="op">=</span> <span class="fu"><a href="../reference/ccd.html">cube</a></span><span class="op">(</span><span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span>,  <span class="va">x3</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">*</span> <span class="va">x2</span>, n0 <span class="op">=</span> <span class="fl">4</span>,</span>
<span>            coding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">~</span> <span class="op">(</span><span class="va">flour</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">.1</span>, <span class="va">x2</span> <span class="op">~</span> <span class="op">(</span><span class="va">sugar</span> <span class="op">-</span> <span class="fl">.5</span><span class="op">)</span><span class="op">/</span><span class="fl">.1</span>, <span class="va">x3</span> <span class="op">~</span> <span class="op">(</span><span class="va">butter</span> <span class="op">-</span> <span class="fl">.25</span><span class="op">)</span><span class="op">/</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>So here is the protocol for the first design.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt1</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##   run.order std.order flour sugar butter</span></span>
<span><span class="co">## 1         1         2   1.1   0.4   0.15</span></span>
<span><span class="co">## 2         2         7   1.0   0.5   0.25</span></span>
<span><span class="co">## 3         3         3   0.9   0.6   0.15</span></span>
<span><span class="co">## 4         4         4   1.1   0.6   0.35</span></span>
<span><span class="co">## 5         5         1   0.9   0.4   0.35</span></span>
<span><span class="co">## 6         6         6   1.0   0.5   0.25</span></span>
<span><span class="co">## 7         7         5   1.0   0.5   0.25</span></span>
<span><span class="co">## 8         8         8   1.0   0.5   0.25</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Data are stored in coded form using these coding formulas ...</span></span>
<span><span class="co">## x1 ~ (flour - 1)/0.1</span></span>
<span><span class="co">## x2 ~ (sugar - 0.5)/0.1</span></span>
<span><span class="co">## x3 ~ (butter - 0.25)/0.1</span></span></code></pre>
<p>It’s important to understand that <code>cube</code> returns a
<em>coded</em> dataset; this facilitates response-surface methodology in
that analyses are best done on a coded scale. The above design is
actually stored in coded form, as we can see by looking at it as an
ordinary <code>data.frame</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">expt1</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##   run.order std.order x1 x2 x3</span></span>
<span><span class="co">## 1         1         2  1 -1 -1</span></span>
<span><span class="co">## 2         2         7  0  0  0</span></span>
<span><span class="co">## 3         3         3 -1  1 -1</span></span>
<span><span class="co">## 4         4         4  1  1  1</span></span>
<span><span class="co">## 5         5         1 -1 -1  1</span></span>
<span><span class="co">## 6         6         6  0  0  0</span></span>
<span><span class="co">## 7         7         5  0  0  0</span></span>
<span><span class="co">## 8         8         8  0  0  0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="but-hold-on-a-minute-first-assess-the-strategy">But hold on a minute… First, assess the strategy<a class="anchor" aria-label="anchor" href="#but-hold-on-a-minute-first-assess-the-strategy"></a>
</h2>
<p>But wait! Before collecting any data, we really should plan ahead and
make sure this is all going to work.</p>
<div class="section level3">
<h3 id="first-order-design-capability">First-order design capability<a class="anchor" aria-label="anchor" href="#first-order-design-capability"></a>
</h3>
<p>First of all, will this initial design do the trick? One helpful tool
in <strong>rsm</strong> is the <code>varfcn</code> function, which
allows us to examine the variance of the predictions we will obtain. We
don’t have any data yet, so this is done in terms of a scaled variance,
defined as <span class="math inline">\(\frac
N{\sigma^2}\mathrm{Var}(\hat{y}(\mathbf{x}))\)</span>, where <span class="math inline">\(N\)</span> is the number of design points, <span class="math inline">\(\sigma^2\)</span> is the error variance and <span class="math inline">\(\hat{y}(\mathbf{x})\)</span> is the predicted
value at a design point <span class="math inline">\(\mathbf{x}\)</span>.
In turn, <span class="math inline">\(\hat{y}(\mathbf{x})\)</span>
depends on the model as well as the experimental design. Usually, <span class="math inline">\(\mathrm{Var}(\hat{y}(\mathbf{x}))\)</span> depends
most strongly on how far <span class="math inline">\(\mathbf{x}\)</span>
is from the center of the design (which is <span class="math inline">\(\mathbf{0}\)</span> in coded units). Accordingly,
the <code>varfcn</code> function requires us to supply the design and
the model, and a few different directions to go from the origin along
which to plot the scaled variance (some defaults are supplied if not
specified). We can look either at a profile plot or a contour plot:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/varfcn.html">varfcn</a></span><span class="op">(</span><span class="va">expt1</span>, <span class="op">~</span> <span class="fu"><a href="../reference/FO.html">FO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/varfcn.html">varfcn</a></span><span class="op">(</span><span class="va">expt1</span>, <span class="op">~</span> <span class="fu"><a href="../reference/FO.html">FO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span>, contour <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="illus_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>Not surprisingly, the variance increases as we go farther out—that
is, estimation is more accurate in the center of the design than in the
periphery. This particular design has the same variance profile in all
directions: this is called a <em>rotatable</em> design.</p>
<p>Another important outcome of this is what do <em>not</em> see: there
are no error messages. That means we can actually fit the intended
model. If we intend to use this design to fit a second-order model, it’s
a different story:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/varfcn.html">varfcn</a></span><span class="op">(</span><span class="va">expt1</span>, <span class="op">~</span> <span class="fu"><a href="../reference/FO.html">SO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in solve.default(t(mm) %*% mm): Lapack routine dgesv: system is exactly singular: U[5,5] = 0</span></span></code></pre>
<p>The point is, <code>varfcn</code> is a useful way to make sure you
can estimate the model you need to fit, <em>before</em> collecting any
data.</p>
</div>
<div class="section level3">
<h3 id="lookahead2">Looking further ahead<a class="anchor" aria-label="anchor" href="#lookahead2"></a>
</h3>
<p>As we mentioned, response-surface experimentation uses a
building-block approach. It could be that we will want to augment this
design so that we can fit a second-order surface. A popular way to do
that is to do a followup experiment on axis or “star” points at
locations <span class="math inline">\(\pm\alpha\)</span> so that the two
experiments combined may be used to fit a second-order model. Will this
work? And if so, what does the variance function look like? Let’s find
out. It turns out that a rotatable design is not achievable by adding
star points:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/djoin.html">djoin</a></span><span class="op">(</span><span class="va">expt1</span>, <span class="fu"><a href="../reference/ccd.html">star</a></span><span class="op">(</span>n0 <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="st">"rotatable"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## Error in star(n0 = 2, alpha = "rotatable", basis = structure(list(run.order = 1:8,  : </span></span>
<span><span class="co">##   Rotatable design is not achievable: inconsistent design moments</span></span></code></pre>
<p>But here are the characteristics of a design with <span class="math inline">\(\alpha = 1.5\)</span>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">followup</span> <span class="op">=</span> <span class="fu"><a href="../reference/djoin.html">djoin</a></span><span class="op">(</span><span class="va">expt1</span>, <span class="fu"><a href="../reference/ccd.html">star</a></span><span class="op">(</span>n0 <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/varfcn.html">varfcn</a></span><span class="op">(</span><span class="va">followup</span>, <span class="op">~</span> <span class="va">Block</span> <span class="op">+</span> <span class="fu"><a href="../reference/FO.html">SO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/varfcn.html">varfcn</a></span><span class="op">(</span><span class="va">followup</span>, <span class="op">~</span> <span class="va">Block</span> <span class="op">+</span> <span class="fu"><a href="../reference/FO.html">SO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span>, contour <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="illus_files/figure-html/unnamed-chunk-9-1.png" width="576">
From this we can tell that we can at least augment the design to fit a
second-order model. The model includes a block effect to account for the
fact that two separately randomized experiments are combined.</p>
<!-- %%% RESTORE THE SEED WE HAD and generate new data -->
</div>
</div>
<div class="section level2">
<h2 id="ok-now-we-can-collect-some-data">OK, <em>now</em> we can collect some data<a class="anchor" aria-label="anchor" href="#ok-now-we-can-collect-some-data"></a>
</h2>
<p>Now, pretend that you now go off and baked some cakes according to
these recipes.</p>
<p>Time passes…</p>
<p>OK, the baking is over, and the results are in, and we entered them
in a new <code>ratings</code> column in <code>expt1</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt1</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##   run.order std.order flour sugar butter rating</span></span>
<span><span class="co">## 1         1         2   1.1   0.4   0.15   28.9</span></span>
<span><span class="co">## 2         2         7   1.0   0.5   0.25   25.5</span></span>
<span><span class="co">## 3         3         3   0.9   0.6   0.15   20.2</span></span>
<span><span class="co">## 4         4         4   1.1   0.6   0.35   27.1</span></span>
<span><span class="co">## 5         5         1   0.9   0.4   0.35   21.5</span></span>
<span><span class="co">## 6         6         6   1.0   0.5   0.25   24.7</span></span>
<span><span class="co">## 7         7         5   1.0   0.5   0.25   25.0</span></span>
<span><span class="co">## 8         8         8   1.0   0.5   0.25   24.7</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Data are stored in coded form using these coding formulas ...</span></span>
<span><span class="co">## x1 ~ (flour - 1)/0.1</span></span>
<span><span class="co">## x2 ~ (sugar - 0.5)/0.1</span></span>
<span><span class="co">## x3 ~ (butter - 0.25)/0.1</span></span></code></pre>
<p>We can now analyze the data using a first-order model (implemented in
<strong>rsm</strong> by the <code>FO</code> function). The model is
fitted in terms of the coded variables.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anal1</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsm.html">rsm</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="fu"><a href="../reference/FO.html">FO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expt1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">anal1</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## rsm(formula = rating ~ FO(x1, x2, x3), data = expt1)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Estimate Std. Error  t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept) 24.70000    0.17963 137.5077 1.678e-08 ***</span></span>
<span><span class="co">## x1           3.57500    0.25403  14.0731 0.0001479 ***</span></span>
<span><span class="co">## x2          -0.77500    0.25403  -3.0508 0.0379977 *  </span></span>
<span><span class="co">## x3          -0.12500    0.25403  -0.4921 0.6484543    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Multiple R-squared:  0.9811, Adjusted R-squared:  0.9669 </span></span>
<span><span class="co">## F-statistic:  69.2 on 3 and 4 DF,  p-value: 0.0006658</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response: rating</span></span>
<span><span class="co">##                Df Sum Sq Mean Sq F value    Pr(&gt;F)</span></span>
<span><span class="co">## FO(x1, x2, x3)  3 53.587 17.8625 69.2010 0.0006658</span></span>
<span><span class="co">## Residuals       4  1.033  0.2581                  </span></span>
<span><span class="co">## Lack of fit     1  0.605  0.6050  4.2456 0.1314343</span></span>
<span><span class="co">## Pure error      3  0.428  0.1425                  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Direction of steepest ascent (at radius 1):</span></span>
<span><span class="co">##          x1          x2          x3 </span></span>
<span><span class="co">##  0.97672947 -0.21173856 -0.03415138 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Corresponding increment in original units:</span></span>
<span><span class="co">##        flour        sugar       butter </span></span>
<span><span class="co">##  0.097672947 -0.021173856 -0.003415138</span></span></code></pre>
<p>The take-home message here is that the first-order model does help
explain the variations in the response (significant <span class="math inline">\(F\)</span> statistic for the model, as well as two
of the three coefficients of <span class="math inline">\(x_j\)</span>
are fairly significant); and also that there is no real evidence that
the model does not fit (large P value for lack of fit). Finally, there
is information on the direction of steepest ascent, which suggests that
we could improve the ratings by increasing the flour and decreasing the
sugar and butter (by smaller amounts in terms of coded units).</p>
</div>
<div class="section level2">
<h2 id="explore-the-path-of-steepest-ascent">Explore the path of steepest-ascent<a class="anchor" aria-label="anchor" href="#explore-the-path-of-steepest-ascent"></a>
</h2>
<p>The direction of steepest ascent is our best guess for how we can
improve the recipe. The <code>steepest</code> function provides an easy
way to find some steps in the right direction, up to a distance of 5 (in
coded units) by default:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span> <span class="va">sa1</span> <span class="op">=</span> <span class="fu"><a href="../reference/steepest.html">steepest</a></span><span class="op">(</span><span class="va">anal1</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## Path of steepest ascent from ridge analysis:</span></span></code></pre>
<pre class="ro"><code><span><span class="co">##    dist    x1     x2     x3 |  flour  sugar butter |   yhat</span></span>
<span><span class="co">## 1   0.0 0.000  0.000  0.000 | 1.0000 0.5000 0.2500 | 24.700</span></span>
<span><span class="co">## 2   0.5 0.488 -0.106 -0.017 | 1.0488 0.4894 0.2483 | 26.529</span></span>
<span><span class="co">## 3   1.0 0.977 -0.212 -0.034 | 1.0977 0.4788 0.2466 | 28.361</span></span>
<span><span class="co">## 4   1.5 1.465 -0.318 -0.051 | 1.1465 0.4682 0.2449 | 30.190</span></span>
<span><span class="co">## 5   2.0 1.953 -0.423 -0.068 | 1.1953 0.4577 0.2432 | 32.018</span></span>
<span><span class="co">## 6   2.5 2.442 -0.529 -0.085 | 1.2442 0.4471 0.2415 | 33.851</span></span>
<span><span class="co">## 7   3.0 2.930 -0.635 -0.102 | 1.2930 0.4365 0.2398 | 35.680</span></span>
<span><span class="co">## 8   3.5 3.419 -0.741 -0.120 | 1.3419 0.4259 0.2380 | 37.512</span></span>
<span><span class="co">## 9   4.0 3.907 -0.847 -0.137 | 1.3907 0.4153 0.2363 | 39.341</span></span>
<span><span class="co">## 10  4.5 4.395 -0.953 -0.154 | 1.4395 0.4047 0.2346 | 41.170</span></span>
<span><span class="co">## 11  5.0 4.884 -1.059 -0.171 | 1.4884 0.3941 0.2329 | 43.002</span></span></code></pre>
<p>The <code>yhat</code> values show what the fitted model anticipates
for the rating; but as we move to further distances, these are serious
extrapolations and can’t be trusted. What we need is real data! So let’s
do a little experiment along this path, using the distances from 0.5 to
4.0, for a total of 8 runs. The <code>dupe</code> function makes a copy
of these runs and re-randomizes the order.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt2</span> <span class="op">=</span> <span class="fu"><a href="../reference/ccd.html">dupe</a></span><span class="op">(</span><span class="va">sa1</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">9</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Now we need to do some more baking based on this design. Time
passes…</p>
<p>The data are now collected; and we have these results:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt2</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##   run.order std.order dist    x1     x2     x3 |  flour  sugar butter |.1   yhat rating</span></span>
<span><span class="co">## 1         1         8  4.0 3.907 -0.847 -0.137 | 1.3907 0.4153 0.2363   | 39.341   24.3</span></span>
<span><span class="co">## 2         2         4  2.0 1.953 -0.423 -0.068 | 1.1953 0.4577 0.2432   | 32.018   26.6</span></span>
<span><span class="co">## 3         3         1  0.5 0.488 -0.106 -0.017 | 1.0488 0.4894 0.2483   | 26.529   24.8</span></span>
<span><span class="co">## 4         4         3  1.5 1.465 -0.318 -0.051 | 1.1465 0.4682 0.2449   | 30.190   27.5</span></span>
<span><span class="co">## 5         5         7  3.5 3.419 -0.741 -0.120 | 1.3419 0.4259 0.2380   | 37.512   27.3</span></span>
<span><span class="co">## 6         6         6  3.0 2.930 -0.635 -0.102 | 1.2930 0.4365 0.2398   | 35.680   27.8</span></span>
<span><span class="co">## 7         7         5  2.5 2.442 -0.529 -0.085 | 1.2442 0.4471 0.2415   | 33.851   26.0</span></span>
<span><span class="co">## 8         8         2  1.0 0.977 -0.212 -0.034 | 1.0977 0.4788 0.2466   | 28.361   25.3</span></span></code></pre>
<p>With a steepest-ascent path, the idea is to find the highest point
along this path, and center the next experiment there. To that end,
let’s look at it graphically:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">dist</span>, data <span class="op">=</span> <span class="va">expt2</span><span class="op">)</span></span>
<span><span class="va">anal2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">dist</span>, <span class="fl">2</span><span class="op">)</span>,  data <span class="op">=</span> <span class="va">expt2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">expt2</span>, <span class="op">{</span></span>
<span>    <span class="va">ord</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">dist</span><span class="op">[</span><span class="va">ord</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">anal2</span><span class="op">)</span><span class="op">[</span><span class="va">ord</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="illus_files/figure-html/unnamed-chunk-17-1.png" width="432"></p>
<p>There is a fair amount of variation here, so the fitted quadratic
curve provides useful guidance. It suggests that we do our next
experiment at a distance of about <span class="math inline">\(2.5\)</span> in coded units, i.e., near point #6
in the steepest-ascent path, <code>sa1</code>. Let’s use somewhat
rounder values: flour:<sub><span class="math inline">\(1.25\)</span></sub>cups, sugar:<sub><span class="math inline">\(0.45\)</span></sub>cups, and butter:<sub><span class="math inline">\(0.25\)</span></sub>cups (unchanged from
<code>expt1</code>).</p>
</div>
<div class="section level2">
<h2 id="relocated-experiment">Relocated experiment<a class="anchor" aria-label="anchor" href="#relocated-experiment"></a>
</h2>
<p>We can run basically the same design we did the first time around,
only with the new center. This is easily done using <code>dupe</code>
and changing the codings:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt3</span> <span class="op">=</span> <span class="fu"><a href="../reference/ccd.html">dupe</a></span><span class="op">(</span><span class="va">expt1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/coded.data.html">codings</a></span><span class="op">(</span><span class="va">expt3</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">~</span> <span class="op">(</span><span class="va">flour</span> <span class="op">-</span> <span class="fl">1.25</span><span class="op">)</span><span class="op">/</span><span class="fl">.1</span>,  <span class="va">x2</span> <span class="op">~</span> <span class="op">(</span><span class="va">sugar</span> <span class="op">-</span> <span class="fl">.45</span><span class="op">)</span><span class="op">/</span><span class="fl">.1</span>,  <span class="va">x3</span> <span class="op">~</span> <span class="op">(</span><span class="va">butter</span> <span class="op">-</span> <span class="fl">.25</span><span class="op">)</span><span class="op">/</span><span class="fl">.1</span><span class="op">)</span></span></code></pre></div>
<p>Again, off to do more baking … Once the data are collected, we
have:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt3</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##   run.order std.order flour sugar butter rating</span></span>
<span><span class="co">## 1         1         5  1.25  0.45   0.25   26.6</span></span>
<span><span class="co">## 2         2         2  1.35  0.35   0.15   25.3</span></span>
<span><span class="co">## 3         3         4  1.35  0.55   0.35   23.7</span></span>
<span><span class="co">## 4         4         3  1.15  0.55   0.15   26.0</span></span>
<span><span class="co">## 5         5         7  1.25  0.45   0.25   27.8</span></span>
<span><span class="co">## 6         6         6  1.25  0.45   0.25   26.2</span></span>
<span><span class="co">## 7         7         1  1.15  0.35   0.35   27.3</span></span>
<span><span class="co">## 8         8         8  1.25  0.45   0.25   27.2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Data are stored in coded form using these coding formulas ...</span></span>
<span><span class="co">## x1 ~ (flour - 1.25)/0.1</span></span>
<span><span class="co">## x2 ~ (sugar - 0.45)/0.1</span></span>
<span><span class="co">## x3 ~ (butter - 0.25)/0.1</span></span></code></pre>
<p>… and we do the same analysis:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anal3</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsm.html">rsm</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="fu"><a href="../reference/FO.html">FO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expt3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">anal3</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## rsm(formula = rating ~ FO(x1, x2, x3), data = expt3)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept) 26.26250    0.40509 64.8306 3.391e-07 ***</span></span>
<span><span class="co">## x1          -1.07500    0.57289 -1.8765    0.1338    </span></span>
<span><span class="co">## x2          -0.72500    0.57289 -1.2655    0.2744    </span></span>
<span><span class="co">## x3          -0.07500    0.57289 -0.1309    0.9022    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Multiple R-squared:  0.5624, Adjusted R-squared:  0.2341 </span></span>
<span><span class="co">## F-statistic: 1.713 on 3 and 4 DF,  p-value: 0.3015</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response: rating</span></span>
<span><span class="co">##                Df Sum Sq Mean Sq F value  Pr(&gt;F)</span></span>
<span><span class="co">## FO(x1, x2, x3)  3 6.7475  2.2492  1.7132 0.30145</span></span>
<span><span class="co">## Residuals       4 5.2512  1.3128                </span></span>
<span><span class="co">## Lack of fit     1 3.7812  3.7812  7.7168 0.06911</span></span>
<span><span class="co">## Pure error      3 1.4700  0.4900                </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Direction of steepest ascent (at radius 1):</span></span>
<span><span class="co">##          x1          x2          x3 </span></span>
<span><span class="co">## -0.82768868 -0.55820864 -0.05774572 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Corresponding increment in original units:</span></span>
<span><span class="co">##        flour        sugar       butter </span></span>
<span><span class="co">## -0.082768868 -0.055820864 -0.005774572</span></span></code></pre>
<p>This may not seem too dissimilar to the <code>anal1</code> results,
and if you think so, that would suggest we just do another
steepest-ascent step. However, none of the linear (first-order) effects
are statistically significant, nor are they even jointly significant
(<span class="math inline">\(P\approx0.30\)</span> in the ANOVA table);
so we don’t have a compelling case that we even know what that direction
might be! It seems better to instead collect more data in this region
and see if we get more clarity.</p>
</div>
<div class="section level2">
<h2 id="foldover-experiment">Foldover experiment<a class="anchor" aria-label="anchor" href="#foldover-experiment"></a>
</h2>
<p>Recall that our first experiment was a half-fraction plus center
points. We can get more information by doing the other fraction. This is
accomplished using the <code>foldover</code> function, which reverses
the signs of some or all of the coded variables (and also re-randomizes
the experiment). In this case, the original experiment was generated
using <span class="math inline">\(x_3=x_1x_2\)</span>, so if we reverse
<span class="math inline">\(x_1\)</span>, we will have <span class="math inline">\(x_3=-x_1x_2\)</span>, thus the other half of the
experiment.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt4</span> <span class="op">=</span> <span class="fu"><a href="../reference/ccd.html">foldover</a></span><span class="op">(</span><span class="va">expt3</span>, variable <span class="op">=</span> <span class="st">"x1"</span><span class="op">)</span></span>
<span><span class="va">expt4</span><span class="op">$</span><span class="va">rating</span> <span class="op">=</span> <span class="cn">NULL</span>  <span class="co">### discard previous rating data</span></span>
<span><span class="va">expt4</span>   <span class="co"># Here's the new protocol</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##   run.order std.order flour sugar butter</span></span>
<span><span class="co">## 1         1         2  1.15  0.35   0.15</span></span>
<span><span class="co">## 2         2         7  1.25  0.45   0.25</span></span>
<span><span class="co">## 3         3         3  1.35  0.55   0.15</span></span>
<span><span class="co">## 4         4         4  1.15  0.55   0.35</span></span>
<span><span class="co">## 5         5         5  1.25  0.45   0.25</span></span>
<span><span class="co">## 6         6         6  1.25  0.45   0.25</span></span>
<span><span class="co">## 7         7         8  1.25  0.45   0.25</span></span>
<span><span class="co">## 8         8         1  1.35  0.35   0.35</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Data are stored in coded form using these coding formulas ...</span></span>
<span><span class="co">## x1 ~ (flour - 1.25)/0.1</span></span>
<span><span class="co">## x2 ~ (sugar - 0.45)/0.1</span></span>
<span><span class="co">## x3 ~ (butter - 0.25)/0.1</span></span></code></pre>
<p>Note that this experiment does indeed have different factor
combinations (e.g., <span class="math inline">\((1.15,.35,.15))\)</span>
not present in <code>expt3</code>.</p>
<p>Back to the kitchen again…</p>
<p>Once the data are collected, we have:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt4</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##   run.order std.order flour sugar butter rating</span></span>
<span><span class="co">## 1         1         2  1.15  0.35   0.15   34.0</span></span>
<span><span class="co">## 2         2         7  1.25  0.45   0.25   35.1</span></span>
<span><span class="co">## 3         3         3  1.35  0.55   0.15   31.0</span></span>
<span><span class="co">## 4         4         4  1.15  0.55   0.35   34.6</span></span>
<span><span class="co">## 5         5         5  1.25  0.45   0.25   35.5</span></span>
<span><span class="co">## 6         6         6  1.25  0.45   0.25   34.9</span></span>
<span><span class="co">## 7         7         8  1.25  0.45   0.25   35.1</span></span>
<span><span class="co">## 8         8         1  1.35  0.35   0.35   33.3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Data are stored in coded form using these coding formulas ...</span></span>
<span><span class="co">## x1 ~ (flour - 1.25)/0.1</span></span>
<span><span class="co">## x2 ~ (sugar - 0.45)/0.1</span></span>
<span><span class="co">## x3 ~ (butter - 0.25)/0.1</span></span></code></pre>
<p>For analysis, we will combine <code>expt3</code> and
<code>expt4</code>, which is easily accomplished with the
<code>djoin</code> function. Note that <code>djoin</code> creates an
additional blocking factor:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span> <span class="fu"><a href="../reference/djoin.html">djoin</a></span><span class="op">(</span><span class="va">expt3</span>, <span class="va">expt4</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## [1] "run.order" "std.order" "x1"        "x2"        "x3"        "rating"    "Block"</span></span></code></pre>
<p>It’s important to include this block effect in the model because we
have two separately randomized experiments. In this particular case,
it’s especially important because <code>expt4</code> seems to have
higher values overall than <code>expt3</code>; either the raters are in
a better mood, or ambient conditions have changed. Here is our
analysis:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anal4</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsm.html">rsm</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">Block</span> <span class="op">+</span> <span class="fu"><a href="../reference/FO.html">FO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="../reference/djoin.html">djoin</a></span><span class="op">(</span><span class="va">expt3</span>, <span class="va">expt4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">anal4</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## rsm(formula = rating ~ Block + FO(x1, x2, x3), data = djoin(expt3, </span></span>
<span><span class="co">##     expt4))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept) 26.26250    0.40329 65.1208 1.388e-15 ***</span></span>
<span><span class="co">## Block2       7.92500    0.57034 13.8953 2.543e-08 ***</span></span>
<span><span class="co">## x1          -1.07500    0.40329 -2.6656   0.02197 *  </span></span>
<span><span class="co">## x2          -0.57500    0.40329 -1.4258   0.18169    </span></span>
<span><span class="co">## x3           0.32500    0.40329  0.8059   0.43739    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Multiple R-squared:  0.9486, Adjusted R-squared:  0.9299 </span></span>
<span><span class="co">## F-statistic: 50.72 on 4 and 11 DF,  p-value: 5.075e-07</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response: rating</span></span>
<span><span class="co">##                Df  Sum Sq Mean Sq  F value    Pr(&gt;F)</span></span>
<span><span class="co">## Block           1 251.223 251.223 193.0793 2.543e-08</span></span>
<span><span class="co">## FO(x1, x2, x3)  3  12.735   4.245   3.2625  0.063177</span></span>
<span><span class="co">## Residuals      11  14.313   1.301                   </span></span>
<span><span class="co">## Lack of fit     5  12.653   2.531   9.1464  0.008934</span></span>
<span><span class="co">## Pure error      6   1.660   0.277                   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Direction of steepest ascent (at radius 1):</span></span>
<span><span class="co">##         x1         x2         x3 </span></span>
<span><span class="co">## -0.8520282 -0.4557360  0.2575899 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Corresponding increment in original units:</span></span>
<span><span class="co">##       flour       sugar      butter </span></span>
<span><span class="co">## -0.08520282 -0.04557360  0.02575899</span></span></code></pre>
<p>Now one of the first-order terms is significant. The lack of fit test
is also quite significant. Response-surface experimentation is different
from some other kinds of experiments in that it’s actually “ideal” in a
way to have nonsignificant effects, especially first-order ones, because
it would suggest we might be close to the peak. Well, we have one big
first-order effect, but evidence of curvature; let’s carry on.</p>
<div class="section level3">
<h3 id="augmenting-further-to-estimate-a-second-order-response-surface">Augmenting further to estimate a second-order response surface<a class="anchor" aria-label="anchor" href="#augmenting-further-to-estimate-a-second-order-response-surface"></a>
</h3>
<p>Because there is lack of fit, it’s now a good idea to collect data at
the “star” or axis points so that we can fit a second-order model. As
illustrated <a href="#lookahead2">earlier</a>, the <code>star</code>
function does this for us. We will choose the parameter
<code>alpha</code> (<span class="math inline">\(\alpha\)</span>) so that
the star block is orthogonal to the cube blocks; this seems like a good
idea, given how strong we have observed the block effect to be. So here
is the next experiment, using the six axis points and 2 center points
(we already have 8 center points at this location), for 8 runs. The
analysis will be based on combining the cube clock, its foldover, and
the star block:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt5</span> <span class="op">=</span> <span class="fu"><a href="../reference/ccd.html">star</a></span><span class="op">(</span><span class="va">expt4</span>, n0 <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="st">"orthogonal"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">comb</span> <span class="op">=</span> <span class="fu"><a href="../reference/djoin.html">djoin</a></span><span class="op">(</span><span class="va">expt3</span>, <span class="va">expt4</span>, <span class="va">expt5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/varfcn.html">varfcn</a></span><span class="op">(</span><span class="va">comb</span>, <span class="op">~</span> <span class="va">Block</span> <span class="op">+</span> <span class="fu"><a href="../reference/FO.html">SO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/varfcn.html">varfcn</a></span><span class="op">(</span><span class="va">comb</span>, <span class="op">~</span> <span class="va">Block</span> <span class="op">+</span> <span class="fu"><a href="../reference/FO.html">SO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span>, contour <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="illus_files/figure-html/unnamed-chunk-27-1.png" width="576"></p>
<p>This is not the second-order design we contemplated earlier, because
it involves adding star points to the complete <span class="math inline">\(2^3\)</span> design; but it has reasonable
prediction-variance properties.</p>
<p>Time passes, more cakes are baked and rated, and we have these
data:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt5</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##   run.order std.order    flour     sugar    butter rating</span></span>
<span><span class="co">## 1         1         4 1.250000 0.5914214 0.2500000   26.0</span></span>
<span><span class="co">## 2         2         2 1.391421 0.4500000 0.2500000   23.9</span></span>
<span><span class="co">## 3         3         6 1.250000 0.4500000 0.3914214   27.6</span></span>
<span><span class="co">## 4         4         7 1.250000 0.4500000 0.2500000   26.7</span></span>
<span><span class="co">## 5         5         1 1.108579 0.4500000 0.2500000   26.7</span></span>
<span><span class="co">## 6         6         5 1.250000 0.4500000 0.1085786   27.3</span></span>
<span><span class="co">## 7         7         3 1.250000 0.3085786 0.2500000   29.3</span></span>
<span><span class="co">## 8         8         8 1.250000 0.4500000 0.2500000   27.4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Data are stored in coded form using these coding formulas ...</span></span>
<span><span class="co">## x1 ~ (flour - 1.25)/0.1</span></span>
<span><span class="co">## x2 ~ (sugar - 0.45)/0.1</span></span>
<span><span class="co">## x3 ~ (butter - 0.25)/0.1</span></span></code></pre>
<p>We will fit a second-order model, accounting for the block
effect.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anal5</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsm.html">rsm</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">Block</span> <span class="op">+</span> <span class="fu"><a href="../reference/FO.html">SO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="../reference/djoin.html">djoin</a></span><span class="op">(</span><span class="va">expt3</span>, <span class="va">expt4</span>, <span class="va">expt5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">anal5</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## rsm(formula = rating ~ Block + SO(x1, x2, x3), data = djoin(expt3, </span></span>
<span><span class="co">##     expt4, expt5))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Estimate  Std. Error  t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)  2.6996e+01  2.5051e-01 107.7647 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## Block2       7.9250e+00  2.9641e-01  26.7366 4.601e-12 ***</span></span>
<span><span class="co">## Block3       6.0000e-01  2.9641e-01   2.0242  0.065795 .  </span></span>
<span><span class="co">## x1          -1.0466e+00  1.7113e-01  -6.1160 5.208e-05 ***</span></span>
<span><span class="co">## x2          -7.7224e-01  1.7113e-01  -4.5125  0.000711 ***</span></span>
<span><span class="co">## x3           2.5202e-01  1.7113e-01   1.4727  0.166578    </span></span>
<span><span class="co">## x1:x2       -4.0000e-01  2.0959e-01  -1.9085  0.080537 .  </span></span>
<span><span class="co">## x1:x3       -1.5000e-01  2.0959e-01  -0.7157  0.487888    </span></span>
<span><span class="co">## x2:x3        7.9051e-16  2.0959e-01   0.0000  1.000000    </span></span>
<span><span class="co">## x1^2        -1.2393e+00  1.9405e-01  -6.3865 3.471e-05 ***</span></span>
<span><span class="co">## x2^2        -6.4286e-02  1.9405e-01  -0.3313  0.746139    </span></span>
<span><span class="co">## x3^2        -1.6429e-01  1.9405e-01  -0.8466  0.413766    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Multiple R-squared:  0.9881, Adjusted R-squared:  0.9772 </span></span>
<span><span class="co">## F-statistic: 90.77 on 11 and 12 DF,  p-value: 8.46e-10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response: rating</span></span>
<span><span class="co">##                 Df  Sum Sq Mean Sq  F value    Pr(&gt;F)</span></span>
<span><span class="co">## Block            2 311.523 155.762 443.2137 5.678e-12</span></span>
<span><span class="co">## FO(x1, x2, x3)   3  21.064   7.021  19.9791 5.849e-05</span></span>
<span><span class="co">## TWI(x1, x2, x3)  3   1.460   0.487   1.3848  0.294838</span></span>
<span><span class="co">## PQ(x1, x2, x3)   3  16.845   5.615  15.9771  0.000172</span></span>
<span><span class="co">## Residuals       12   4.217   0.351                   </span></span>
<span><span class="co">## Lack of fit      5   2.312   0.462   1.6993  0.252578</span></span>
<span><span class="co">## Pure error       7   1.905   0.272                   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Stationary point of response surface:</span></span>
<span><span class="co">##         x1         x2         x3 </span></span>
<span><span class="co">##  1.0644952 -9.3180901  0.2810583 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Stationary point in original units:</span></span>
<span><span class="co">##      flour      sugar     butter </span></span>
<span><span class="co">##  1.3564495 -0.4818090  0.2781058 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Eigenanalysis:</span></span>
<span><span class="co">## eigen() decomposition</span></span>
<span><span class="co">## $values</span></span>
<span><span class="co">## [1] -0.03002067 -0.16052168 -1.27731479</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $vectors</span></span>
<span><span class="co">##           [,1]        [,2]       [,3]</span></span>
<span><span class="co">## x1  0.16811860 -0.04985422 0.98450530</span></span>
<span><span class="co">## x2 -0.98128332 -0.10360829 0.16232180</span></span>
<span><span class="co">## x3 -0.09391048  0.99336795 0.06633959</span></span></code></pre>
<p>There are significant first and second-order terms now, and
nonsignificant lack of fit. The summary includes a canonical analysis
which gives the coordinates of the estimated stationary point and the
canonical directions (eigenvectors) from that point. That is, the fitted
surface is characterized in the form <span class="math inline">\(\hat{y}(v_1,v_2,v_3) = \hat{y}_s + \lambda_1v_1^2
+ \lambda_2v_2^2 + \lambda_3v_3^2\)</span> where <span class="math inline">\(\hat{y}_s\)</span> is the fitted value at the
stationary point, the eigenvalues are denoted <span class="math inline">\(\lambda_j\)</span>, and the eigenvectors are
denoted <span class="math inline">\(v_j\)</span>. Since all three
eigenvalues are negative, the estimated surface decreases in all
directions from its value at <span class="math inline">\(\hat{y}_s\)</span> and hence there is a maximum
there. However, the stationary point is nowhere near the experiment, so
this is an extreme extrapolation and not to be trusted at all. (In fact,
in decoded units, the estimated optimum calls for a negative amount of
sugar!) So the best bet now is to experiment on some path that leads us
vaguely toward this distant stationary point.</p>
</div>
</div>
<div class="section level2">
<h2 id="ridge-analysis-second-order-steepest-ascent">Ridge analysis (second-order steepest ascent)<a class="anchor" aria-label="anchor" href="#ridge-analysis-second-order-steepest-ascent"></a>
</h2>
<p>The <code>steepest</code> function again may be used; this time it
computes a curved path of steepest ascent, based on ridge analysis:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/steepest.html">steepest</a></span><span class="op">(</span><span class="va">anal5</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## Path of steepest ascent from ridge analysis:</span></span></code></pre>
<pre class="ro"><code><span><span class="co">##    dist     x1     x2    x3 |  flour   sugar butter |   yhat</span></span>
<span><span class="co">## 1   0.0  0.000  0.000 0.000 | 1.2500  0.4500 0.2500 | 26.996</span></span>
<span><span class="co">## 2   0.5 -0.227 -0.417 0.156 | 1.2273  0.4083 0.2656 | 27.484</span></span>
<span><span class="co">## 3   1.0 -0.235 -0.922 0.307 | 1.2265  0.3578 0.2807 | 27.817</span></span>
<span><span class="co">## 4   1.5 -0.189 -1.431 0.408 | 1.2311  0.3069 0.2908 | 28.102</span></span>
<span><span class="co">## 5   2.0 -0.126 -1.939 0.473 | 1.2374  0.2561 0.2973 | 28.358</span></span>
<span><span class="co">## 6   2.5 -0.055 -2.446 0.514 | 1.2445  0.2054 0.3014 | 28.591</span></span>
<span><span class="co">## 7   3.0  0.020 -2.951 0.536 | 1.2520  0.1549 0.3036 | 28.804</span></span>
<span><span class="co">## 8   3.5  0.098 -3.456 0.546 | 1.2598  0.1044 0.3046 | 28.999</span></span>
<span><span class="co">## 9   4.0  0.178 -3.959 0.546 | 1.2678  0.0541 0.3046 | 29.177</span></span>
<span><span class="co">## 10  4.5  0.258 -4.459 0.538 | 1.2758  0.0041 0.3038 | 29.337</span></span>
<span><span class="co">## 11  5.0  0.339 -4.961 0.525 | 1.2839 -0.0461 0.3025 | 29.481</span></span></code></pre>
<p>After a distance of about 3, it starts venturing into unreasonable
combinations of design factors. So let’s experiment at 8 distances
spread 2/3 apart in coded units:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt6</span> <span class="op">=</span> <span class="fu"><a href="../reference/ccd.html">dupe</a></span><span class="op">(</span><span class="fu"><a href="../reference/steepest.html">steepest</a></span><span class="op">(</span><span class="va">anal5</span>, dist <span class="op">=</span> <span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## Path of steepest ascent from ridge analysis:</span></span></code></pre>
<p>After the cakes have been baked and rated, we have</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt6</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##   run.order std.order      dist     x1     x2    x3 |  flour  sugar butter |.1   yhat rating</span></span>
<span><span class="co">## 1         1         3 1.3333333 -0.207 -1.261 0.379 | 1.2293 0.3239 0.2879   | 28.011   35.5</span></span>
<span><span class="co">## 2         2         5 2.0000000 -0.126 -1.939 0.473 | 1.2374 0.2561 0.2973   | 28.358   33.8</span></span>
<span><span class="co">## 3         3         2 1.0000000 -0.235 -0.922 0.307 | 1.2265 0.3578 0.2807   | 27.817   35.0</span></span>
<span><span class="co">## 4         4         1 0.6666667 -0.241 -0.584 0.212 | 1.2259 0.3916 0.2712   | 27.603   34.1</span></span>
<span><span class="co">## 5         5         7 2.6666667 -0.030 -2.615 0.523 | 1.2470 0.1885 0.3023   | 28.664   33.3</span></span>
<span><span class="co">## 6         6         6 2.3333333 -0.079 -2.278 0.502 | 1.2421 0.2222 0.3002   | 28.516   34.2</span></span>
<span><span class="co">## 7         7         4 1.6666667 -0.169 -1.600 0.433 | 1.2331 0.2900 0.2933   | 28.190   34.7</span></span>
<span><span class="co">## 8         8         8 3.0000000  0.020 -2.951 0.536 | 1.2520 0.1549 0.3036   | 28.804   33.4</span></span></code></pre>
<p>And let’s do an analysis like that of <code>expt2</code>:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">+</span><span class="fl">.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">dist</span>, data <span class="op">=</span> <span class="va">expt6</span><span class="op">)</span></span>
<span><span class="va">anal6</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">dist</span>, <span class="fl">2</span><span class="op">)</span>,  data <span class="op">=</span> <span class="va">expt6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">expt6</span>, <span class="op">{</span></span>
<span>    <span class="va">ord</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">dist</span><span class="op">[</span><span class="va">ord</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">anal6</span><span class="op">)</span><span class="op">[</span><span class="va">ord</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="illus_files/figure-html/unnamed-chunk-35-1.png" width="432"></p>
<p>It looks like we should center a new experiment at a distance of 1.5
or so—perhaps flour still at 1.25, and both sugar and butter at .30.</p>
</div>
<div class="section level2">
<h2 id="second-order-design-at-the-new-location">Second-order design at the new location<a class="anchor" aria-label="anchor" href="#second-order-design-at-the-new-location"></a>
</h2>
<p>We are now in a situation where we already know we have curvature, so
we might as well go straight to a second-order experiment. It is less
critical to assess lack of fit, so we don’t need as many center points.
Note that each of the past experiments has 8 runs—that is the practical
size for one block. All these things considered, we decide to run a
central-composite design with the cube portion being a complete <span class="math inline">\(2^3\)</span> design (8 runs with no center
points), and the star portion including two center points (another block
of 8 runs). Let’s generate the design, and magically do the cooking and
the rating for these two 8-run experiments:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt7</span>  <span class="op">=</span>  <span class="fu"><a href="../reference/ccd.html">ccd</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span>,  n0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,  alpha <span class="op">=</span> <span class="st">"orth"</span>,  coding  <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="va">x1</span> <span class="op">~</span> <span class="op">(</span><span class="va">flour</span> <span class="op">-</span> <span class="fl">1.25</span><span class="op">)</span><span class="op">/</span><span class="fl">.1</span>,  <span class="va">x2</span> <span class="op">~</span> <span class="op">(</span><span class="va">sugar</span> <span class="op">-</span> <span class="fl">.3</span><span class="op">)</span><span class="op">/</span><span class="fl">.1</span>,  <span class="va">x3</span> <span class="op">~</span> <span class="op">(</span><span class="va">butter</span> <span class="op">-</span> <span class="fl">.3</span><span class="op">)</span><span class="op">/</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>… and after the data are collected:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expt7</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##    run.order std.order flour sugar butter Block rating</span></span>
<span><span class="co">## 1          1         5  1.15   0.2    0.4     1   26.6</span></span>
<span><span class="co">## 2          2         1  1.15   0.2    0.2     1   25.6</span></span>
<span><span class="co">## 3          3         6  1.35   0.2    0.4     1   26.6</span></span>
<span><span class="co">## 4          4         3  1.15   0.4    0.2     1   26.2</span></span>
<span><span class="co">## 5          5         8  1.35   0.4    0.4     1   24.5</span></span>
<span><span class="co">## 6          6         7  1.15   0.4    0.4     1   27.3</span></span>
<span><span class="co">## 7          7         2  1.35   0.2    0.2     1   23.5</span></span>
<span><span class="co">## 8          8         4  1.35   0.4    0.2     1   24.7</span></span>
<span><span class="co">## 9          1         8  1.25   0.3    0.3     2   27.9</span></span>
<span><span class="co">## 10         2         2  1.45   0.3    0.3     2   22.0</span></span>
<span><span class="co">## 11         3         5  1.25   0.3    0.1     2   25.2</span></span>
<span><span class="co">## 12         4         3  1.25   0.1    0.3     2   26.5</span></span>
<span><span class="co">## 13         5         4  1.25   0.5    0.3     2   25.9</span></span>
<span><span class="co">## 14         6         6  1.25   0.3    0.5     2   27.8</span></span>
<span><span class="co">## 15         7         1  1.05   0.3    0.3     2   26.0</span></span>
<span><span class="co">## 16         8         7  1.25   0.3    0.3     2   29.3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Data are stored in coded form using these coding formulas ...</span></span>
<span><span class="co">## x1 ~ (flour - 1.25)/0.1</span></span>
<span><span class="co">## x2 ~ (sugar - 0.3)/0.1</span></span>
<span><span class="co">## x3 ~ (butter - 0.3)/0.1</span></span></code></pre>
<p>It turns out that to obtain orthogonal blocks, locating the star
points at <span class="math inline">\(\pm\alpha=\pm2\)</span> is the
correct choice for these numbers of center points; hence the nice round
values. Here’s our analysis; we’ll go straight to the second-order
model, and again, we need to include the block effect in the model.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anal7</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsm.html">rsm</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">Block</span> <span class="op">+</span> <span class="fu"><a href="../reference/FO.html">SO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">expt7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">anal7</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## rsm(formula = rating ~ Block + SO(x1, x2, x3), data = expt7)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept) 27.90000    0.52417 53.2274 4.426e-08 ***</span></span>
<span><span class="co">## Block2       0.70000    0.37064  1.8886  0.117568    </span></span>
<span><span class="co">## x1          -0.90000    0.18532 -4.8564  0.004648 ** </span></span>
<span><span class="co">## x2          -0.05000    0.18532 -0.2698  0.798093    </span></span>
<span><span class="co">## x3           0.63750    0.18532  3.4400  0.018436 *  </span></span>
<span><span class="co">## x1:x2       -0.27500    0.26208 -1.0493  0.342094    </span></span>
<span><span class="co">## x1:x3        0.10000    0.26208  0.3816  0.718466    </span></span>
<span><span class="co">## x2:x3       -0.40000    0.26208 -1.5262  0.187476    </span></span>
<span><span class="co">## x1^2        -1.15000    0.18532 -6.2055  0.001587 ** </span></span>
<span><span class="co">## x2^2        -0.60000    0.18532 -3.2376  0.023010 *  </span></span>
<span><span class="co">## x3^2        -0.52500    0.18532 -2.8329  0.036549 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Multiple R-squared:  0.9421, Adjusted R-squared:  0.8262 </span></span>
<span><span class="co">## F-statistic: 8.131 on 10 and 5 DF,  p-value: 0.01602</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response: rating</span></span>
<span><span class="co">##                 Df  Sum Sq Mean Sq F value   Pr(&gt;F)</span></span>
<span><span class="co">## Block            1  1.9600  1.9600  3.5669 0.117568</span></span>
<span><span class="co">## FO(x1, x2, x3)   3 19.5025  6.5008 11.8305 0.010422</span></span>
<span><span class="co">## TWI(x1, x2, x3)  3  1.9650  0.6550  1.1920 0.401731</span></span>
<span><span class="co">## PQ(x1, x2, x3)   3 21.2550  7.0850 12.8935 0.008653</span></span>
<span><span class="co">## Residuals        5  2.7475  0.5495                 </span></span>
<span><span class="co">## Lack of fit      4  1.7675  0.4419  0.4509 0.789337</span></span>
<span><span class="co">## Pure error       1  0.9800  0.9800                 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Stationary point of response surface:</span></span>
<span><span class="co">##         x1         x2         x3 </span></span>
<span><span class="co">## -0.3421914 -0.1772769  0.6420873 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Stationary point in original units:</span></span>
<span><span class="co">##     flour     sugar    butter </span></span>
<span><span class="co">## 1.2157809 0.2822723 0.3642087 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Eigenanalysis:</span></span>
<span><span class="co">## eigen() decomposition</span></span>
<span><span class="co">## $values</span></span>
<span><span class="co">## [1] -0.3390336 -0.7534946 -1.1824718</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $vectors</span></span>
<span><span class="co">##          [,1]       [,2]         [,3]</span></span>
<span><span class="co">## x1  0.1562180 -0.1664741  0.973592470</span></span>
<span><span class="co">## x2 -0.6513590  0.7236263  0.228246488</span></span>
<span><span class="co">## x3  0.7425142  0.6698144 -0.004609058</span></span></code></pre>
<p>The model fits decently, and there are important second-order terms.
The most exciting news is that the stationary point is quite close to
the design center, and it is indeed a maximum since all three
eigenvalues are negative. It looks like the best recipe is around <span class="math inline">\(1.22\)</span><sub>c.</sub>flour, <span class="math inline">\(.28\)</span><sub>c.</sub>sugar, and <span class="math inline">\(.36\)</span><sub>c.</sub>butter. Let’s look at
this graphically using the <code>contour</code> function, slicing the
fitted surface at the stationary point.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.lab<span class="op">=</span><span class="fl">1.25</span>, cex.axis<span class="op">=</span><span class="fl">1</span>, cex.sub<span class="op">=</span><span class="fl">1.5</span>, mar<span class="op">=</span><span class="fl">.1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.5</span>,<span class="fl">7</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="va">anal7</span>, <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span>, at <span class="op">=</span> <span class="fu"><a href="../reference/rsm.html">xs</a></span><span class="op">(</span><span class="va">anal7</span><span class="op">)</span>, image <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="illus_files/figure-html/unnamed-chunk-40-1.png" width="768"></p>
<p>It’s also helpful to know how well we have estimated the stationary
point. A simple bootstrap procedure helps us understand this. In the
code below, we simulate 200 re-fits of the model, after scrambling the
residuals and adding them back to the fitted values; then plot the their
stationary points along with the one estimated from <code>anal7</code>.
The <code>replicate</code> function returns a matrix with 3 rows and 200
columns (one for each bootstrap replication); so we need to transpose
the result and decode the values.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fits</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">anal7</span><span class="op">)</span></span>
<span><span class="va">resids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">anal7</span><span class="op">)</span></span>
<span><span class="va">boot.raw</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fu"><a href="../reference/rsm.html">xs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">anal7</span>, <span class="va">fits</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">resids</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">boot</span> <span class="op">=</span> <span class="fu"><a href="../reference/coded.data.html">code2val</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">boot.raw</span><span class="op">)</span><span class="op">)</span>, codings<span class="op">=</span><span class="fu"><a href="../reference/coded.data.html">codings</a></span><span class="op">(</span><span class="va">anal7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fl">.1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, cex.lab<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sugar</span> <span class="op">~</span> <span class="va">flour</span>, data <span class="op">=</span> <span class="va">boot</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>;   <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1.215</span>, <span class="fl">.282</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">butter</span> <span class="op">~</span> <span class="va">flour</span>, data <span class="op">=</span> <span class="va">boot</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>;  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1.215</span>, <span class="fl">.364</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">butter</span> <span class="op">~</span> <span class="va">sugar</span>, data <span class="op">=</span> <span class="va">boot</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>;  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">.282</span>, <span class="fl">.364</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p><img src="illus_files/figure-html/unnamed-chunk-41-1.png" width="672"></p>
<p>These plots show something akin to a confidence region for the best
recipe. Note they do not follow symmetrical elliptical patterns, as
would a multivariate normal; this is due primarily to nonlinearity in
estimating the stationary point.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>For convenience, here is a tabular summary of what we did</p>
<table class="table">
<colgroup>
<col width="21%">
<col width="21%">
<col width="21%">
<col width="15%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th align="left">Expt</th>
<th align="left">Center</th>
<th align="left">Type</th>
<th align="left">Runs</th>
<th align="left">Result</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left"><span class="math inline">\((1.00,.50,.25)\)</span></td>
<td align="left"><span class="math inline">\(2^{3-1} +
4\times0\)</span></td>
<td align="left">8</td>
<td align="left">Fit OK, but we’re on a slope</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left"></td>
<td align="left">SA path</td>
<td align="left">8</td>
<td align="left">Re-center at distance <span class="math inline">\(\sim2.5\)</span>
</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left"><span class="math inline">\((1.25,.45,.25)\)</span></td>
<td align="left"><span class="math inline">\(2^{3-1} +
4\times0\)</span></td>
<td align="left">8</td>
<td align="left">Need more data to say much</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">same</td>
<td align="left">Foldover</td>
<td align="left"><span class="math inline">\(+8\)</span></td>
<td align="left">LOF; need second-order design</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">same</td>
<td align="left">Star block</td>
<td align="left"><span class="math inline">\(+8\)</span></td>
<td align="left">Suggests move to a new center</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left"></td>
<td align="left">SA path</td>
<td align="left">8</td>
<td align="left">Re center at distance <span class="math inline">\(\sim1.5\)</span>
</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="left"><span class="math inline">\((1.25,.30,.30)\)</span></td>
<td align="left">CCD: <span class="math inline">\(2^3\)</span>; <span class="math inline">\(\text{star}+2\times0\)</span>
</td>
<td align="left"><span class="math inline">\(8+8\)</span></td>
<td align="left">Best recipe: (1.22,.28,.36)</td>
</tr>
</tbody>
</table>
<p>It has required 64 experimental runs to find this optimum. That is
not too bad considering how much variation there is in the response
measures.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russell Lenth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rsm">
<title>Surface Plots in the rsm Package • rsm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Surface Plots in the rsm Package">
<meta property="og:description" content="rsm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rsm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.10.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/article-JSS.html">Response-Surface Methods in R, Using rsm</a>
    <a class="dropdown-item" href="../articles/illus.html">Response-surface illustration</a>
    <a class="dropdown-item" href="../articles/plots.html">Surface Plots in the rsm Package</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="https://github.com/rvlenth/rsm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Surface Plots in the rsm Package</h1>
                        <h4 data-toc-skip class="author">rsm package,
Version 2.10.5</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rvlenth/rsm/blob/HEAD/vignettes/plots.rmd"><code>vignettes/plots.rmd</code></a></small>
      <div class="d-none name"><code>plots.rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="abstract">Abstract<a class="anchor" aria-label="anchor" href="#abstract"></a>
</h3>
<p>This is a companion to the main vignette for the <strong>rsm</strong>
package, providing more details on how to use the <code>contour</code>,
<code>image</code>, and <code>persp</code> to visualize fitted response
surfaces. While designed with <code>rsm</code> objects in mind, these
methods work with any <code>lm</code> object and thus provide a quick
way to graph a fitted surface. Enhancements include coloring, adding
contour lines to perspective plots, and hooks that provide additional
annotations.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>When a regression model is fitted using two or more continuous
predictors, it is useful to present a graphical visualization of the
fitted surface.<br>
To this end, the functions <code>contour.lm</code>,
<code>persp.lm</code> and <code>image.lm</code> were developed and
incorporated in the <strong>rsm</strong> package, inasmuch as surface
visualization is especially important when using response-surface
methods. The three functions are S3 methods for objects of class
<code>lm</code>, or classes (such as <code>rsm</code>) that inherit from
<code>lm</code>.</p>
<p>This vignette is not meant to document the functions; please refer to
the help pages for details. Our goal here is to illustrate their
use.</p>
</div>
<div class="section level2">
<h2 id="models-with-two-predictors">Models with two predictors<a class="anchor" aria-label="anchor" href="#models-with-two-predictors"></a>
</h2>
<p>Consider an example using the ubiquitous <code>swiss</code> dataset
that is standard in R. Let us fit a model for <code>Fertility</code> as
a polynomial function of <code>Agriculture</code> and
<code>Education</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">swiss2.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Fertility</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">Agriculture</span>, <span class="va">Education</span>, degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, data<span class="op">=</span><span class="va">swiss</span><span class="op">)</span></span></code></pre></div>
<p>The following basic calls illustrate the default results from the
three functions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rvlenth/rsm">rsm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">swiss2.lm</span>, <span class="va">Education</span> <span class="op">~</span> <span class="va">Agriculture</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="va">swiss2.lm</span>, <span class="va">Education</span> <span class="op">~</span> <span class="va">Agriculture</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/persp.html" class="external-link">persp</a></span><span class="op">(</span><span class="va">swiss2.lm</span>, <span class="va">Education</span> <span class="op">~</span> <span class="va">Agriculture</span>, zlab <span class="op">=</span> <span class="st">"Fertility"</span><span class="op">)</span></span></code></pre></div>
<p><img src="plots_files/figure-html/unnamed-chunk-3-1.png" width="816">
Note that we use a formula in the second argument to specify which
variable goes on which axis. The <code>persp</code> plot uses a
different viewpoint, distance, and tick type than the default; I feel
that these new defaults are better for viewing response surfaces.</p>
<p>Generally, perspective plots are best not displayed in too small a
space. It also helps to enhance them with shading, colors, or contour
lines. The following call illustrates how to create an enhanced version
of the perspective plot with a different point of view, shading, a
different surface color, and contour lines added to the top surface of
the box. We also restrict the predictor values to narrower ranges.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/persp.html" class="external-link">persp</a></span><span class="op">(</span><span class="va">swiss2.lm</span>, <span class="va">Education</span> <span class="op">~</span> <span class="va">Agriculture</span>, col <span class="op">=</span> <span class="st">"blue"</span>, </span>
<span>  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Agriculture<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">70</span><span class="op">)</span>, Education<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">30</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  zlab <span class="op">=</span> <span class="st">"Predicted Fertility"</span>, </span>
<span>  contours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>z<span class="op">=</span><span class="st">"top"</span>, col<span class="op">=</span><span class="st">"orange"</span>, shade <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>  theta <span class="op">=</span> <span class="op">-</span><span class="fl">135</span>, phi <span class="op">=</span> <span class="fl">35</span><span class="op">)</span></span></code></pre></div>
<p><img src="plots_files/figure-html/unnamed-chunk-4-1.png" width="528"></p>
</div>
<div class="section level2">
<h2 id="three-or-more-predictors">Three or more predictors<a class="anchor" aria-label="anchor" href="#three-or-more-predictors"></a>
</h2>
<p>When a regression model has more than two continuous predictors, some
additional issues arise:</p>
<ol style="list-style-type: decimal">
<li>We can use only two predictors at a time in an image, contour, or
surface plot.</li>
<li>For two given predictors, the surface plot will change depending on
the values of the other predictors. (The defaults for
<code>image</code>, <code>contour</code>, and <code>persp</code> is to
use the average, but this can be changed.)</li>
<li>There will be more than one surface plot; it is desirable to keep
the scaling and coloring consistent among all these plots. (This happens
automatically in all three functions; there is no way to defeat it other
than by manually plotting the retrieved surface data.)</li>
</ol>
<p>For illustration, we will use the data from a paper-helicopter
experiment described in Box *et al. (2005), page 499, and provided in
the <strong>rsm</strong> package as the dataset <code>heli</code>. The
variables are coded variables <span class="math inline">\(x_1\)</span>–<span class="math inline">\(x_4\)</span>, which are, respectively, linear
functions of wing area <span class="math inline">\(A\)</span>, wing
length ratio <span class="math inline">\(R\)</span>, body width <span class="math inline">\(W\)</span>, and body length <span class="math inline">\(L\)</span>. the experiment was run in two blocks,
and the response variable is <code>ave</code>, the average flight time
in seconds. This dataset is analyzed in more detail in the . A
second-order response-surface model for these data is obtained using</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">heli.rsm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsm.html">rsm</a></span><span class="op">(</span><span class="va">ave</span> <span class="op">~</span> <span class="va">block</span> <span class="op">+</span> <span class="fu"><a href="../reference/FO.html">SO</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span>,<span class="va">x4</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">heli</span><span class="op">)</span></span></code></pre></div>
<p>An <code>rsm</code> object is an extension of a <code>lm</code>
object with extra response-surface-related information included. To
obtain contour plots with each of the 6 possible pairs of the variables
<span class="math inline">\(x_1\)</span>–<span class="math inline">\(x_4\)</span>, simply specify the formula
<code>~ x1 + x2 + x3 + x4</code> in the call to
<code>contour</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span> <span class="op">(</span><span class="va">heli.rsm</span>, <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span><span class="op">)</span></span></code></pre></div>
<p><img src="plots_files/figure-html/unnamed-chunk-6-1.png" width="768">
The <code>heli</code> dataset is an extension of <code>data.frame</code>
that contains the coding information, and this information is retained
in <code>heli.rsm</code>. When such coding is present, then by default,
the coding formulas are used to decode the axis values <span class="math inline">\(x_1,x_2,x_3,x_4\)</span> to their original values
<span class="math inline">\(A,R,W,L\)</span>.</p>
<p>Also, when variables other than those on the coordinate axes are
involved, then what is displayed is a <em>slice</em> of the response
surface, holding the other variables fixed at certain values. By
default, we use the averages of numeric predictors, and the first levels
of factors. This information is incorporated as part of the <span class="math inline">\(x\)</span>-axis label in each contour plot. In
this example, we are probably more interested in the behavior of the
response surface in a neighborhood of the stationary point (where the
gradient is zero). We show how to do this after a little bit more
discussion in the next section.</p>
</div>
<div class="section level2">
<h2 id="annotations-and-hooks">Annotations and hooks<a class="anchor" aria-label="anchor" href="#annotations-and-hooks"></a>
</h2>
<p>Suppose in the helicopter example, we want to add some annotations to
the plots. Since there are several plots, we don’t want to do this
manually. The <code>contour</code> method for <code>lm</code> objects
(as well as <code>image</code> and <code>persp</code>) allow one to
specify a <code>hook</code> argument to take care of things like that.
The hook should be a <code>list</code> containing function definitions
for one or both of <code>pre.plot</code> and <code>post.plot</code>.
Obviously, these are functions that are run just before, and just after,
each plot is constructed. Each function is passed one argument, a
character vector of length <span class="math inline">\(4\)</span>;
elements <span class="math inline">\(1\)</span> and~2 are the labels for
the horizontal and vertical axes; elements <span class="math inline">\(3\)</span> and~<span class="math inline">\(4\)</span> are the corresponding variable names;
and element 5 is a label describing the slice being plotted.</p>
<p>In the following code, we set up a <code>post.plot</code> hook to
plot the position of the stationary point in each graph.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsm.html">canonical</a></span><span class="op">(</span><span class="va">heli.rsm</span><span class="op">)</span><span class="op">$</span><span class="va">xs</span>          <span class="co"># stat.pt. in coded units</span></span>
<span><span class="va">SP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coded.data.html">code2val</a></span><span class="op">(</span><span class="va">xs</span>, <span class="fu"><a href="../reference/coded.data.html">codings</a></span><span class="op">(</span><span class="va">heli.rsm</span><span class="op">)</span><span class="op">)</span> <span class="co"># in decoded units</span></span>
<span><span class="va">myhook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">myhook</span><span class="op">$</span><span class="va">post.plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lab</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lab</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">grep</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">xs</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span> <span class="op">(</span><span class="va">SP</span><span class="op">[</span><span class="va">idx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">SP</span><span class="op">[</span><span class="va">idx</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The coding is a bit tedious due to the need to match elements of
<code>xs</code> with the variable names. And it gets trickier because
<code>contour</code> is smart enough to decode the coordinates into
original units, but it doesn’t do any decoding with any
<code>hook</code> functions; that is left to the user.</p>
<p>To create an enhanced contour plot, use the <code>at</code> argument
to specify that we want the plots sliced at the stationary point instead
of the origin, the <code>image</code> argument to enhance the plots with
a background color image, and use <code>hook</code> to incorporate the
above hook function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span> <span class="op">(</span><span class="va">heli.rsm</span>, <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span>, image <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  at <span class="op">=</span> <span class="va">xs</span>, hook <span class="op">=</span> <span class="va">myhook</span><span class="op">)</span></span></code></pre></div>
<p><img src="plots_files/figure-html/unnamed-chunk-8-1.png" width="768">
Centering at the stationary point gives an entirely different view of
the fitted surface than is seen in the previous figure.</p>
</div>
<div class="section level2">
<h2 id="saving-graphs">Saving graphs<a class="anchor" aria-label="anchor" href="#saving-graphs"></a>
</h2>
<p>Sometimes we may want to access individual plots in a multi-panel
frame. For PS and PDF, this is easy to handle. For example, consider
this code:</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"heli-cps.pdf"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span> <span class="op">(</span><span class="va">heli.rsm</span>, <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span>, image <span class="op">=</span> <span class="cn">TRUE</span>, at <span class="op">=</span> <span class="va">xs</span>, hook <span class="op">=</span> <span class="va">myhook</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>The resulting file will have six pages, one per graph. We can then
import, say, the fourth graph into a <strong>pdflatex</strong> source
file using a command like</p>
<pre><code>\includegraphics[width=.75\linewidth, page=4]{heli-cps.pdf}</code></pre>
<p>For other formats, we can use hooks to create separate files based on
variable names. For example,
<code>{r}{eval=FALSE} png.hook &lt;- list() png.hook$pre.plot &lt;- function(lab)      png(file = paste(lab[3], lab[4], `.png`, sep = ``)) png.hook$post.plot = function(lab)     dev.off() contour (heli.rsm, ~ x1 + x2 + x3 + x4, image = TRUE, at = xs, hook = png.hook)</code></p>
</div>
<div class="section level2">
<h2 id="more-on-perspective-plots">More on perspective plots<a class="anchor" aria-label="anchor" href="#more-on-perspective-plots"></a>
</h2>
<p>The <code>lm</code> method for <code>persp</code> handles its
<code>col</code> argument differently than the default
<code>persp</code> function. For other than a single color, it
determines surface-facet colors based on the fitted response value (like
is done in <code>image</code>) rather than requiring a matrix of facet
colors.</p>
<div class="section level3">
<h3 id="adding-contours">Adding contours<a class="anchor" aria-label="anchor" href="#adding-contours"></a>
</h3>
<p>To add contour lines to a perspective plot, use the
<code>contours</code> argument. It may be a boolean value, character
value, or a list. With <code>contours=TRUE</code> or equivalently, ,
contour lines are drawn on the bottom surface of the box using the
default foreground color. With <code>contours="top"</code>, they are
drawn at the top. Bottom contours are drawn before the surface is drawn
(so they may become partially obscured), and top contours are drawn
afterward. A value of <code>contours="colors"</code> will draw the
contours on the bottom, using the same colors as the corresponding
contour levels on the surface (as illustrated in the prespective plot).
Any other character value of <code>contours</code> will be taken as a
color name for the contours, e.g., <code>contours="green"</code>. For
more control, <code>contours</code> can be a list containing any or all
of <code>col</code> (which may be either <code>"colors"</code> or a
valid color), “z” (which may be <code>"top"</code>,
<code>"bottom"</code>, or a numeric <span class="math inline">\(z\)</span> value), and <code>"lwd"</code> (to
control the width of the lines).</p>
<p>\begin{figure}</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/persp.html" class="external-link">persp</a></span> <span class="op">(</span><span class="va">heli.rsm</span>, <span class="va">x2</span> <span class="op">~</span> <span class="va">x1</span>, at <span class="op">=</span> <span class="va">xs</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>, contours <span class="op">=</span> <span class="st">"colors"</span><span class="op">)</span></span></code></pre></div>
<p><img src="plots_files/figure-html/unnamed-chunk-9-1.png" width="528"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/persp.html" class="external-link">persp</a></span> <span class="op">(</span><span class="va">heli.rsm</span>, <span class="va">x4</span> <span class="op">~</span> <span class="va">x1</span>, at <span class="op">=</span> <span class="va">xs</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>, contours <span class="op">=</span> <span class="st">"colors"</span><span class="op">)</span></span></code></pre></div>
<p><img src="plots_files/figure-html/unnamed-chunk-9-2.png" width="528"></p>
</div>
</div>
<div class="section level2">
<h2 id="doing-it-your-own-way">Doing it your own way<a class="anchor" aria-label="anchor" href="#doing-it-your-own-way"></a>
</h2>
<p>If these functions do not produce exactly the plot you want, you may
still be able to save yourself a lot of work by calling
<code>contour</code> with the desired object and formula(s), and
<code>plot.it=FALSE</code>. The returned object is a list of data for
each plot—the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> values, the <span class="math inline">\(z\)</span> matrix, the range of <span class="math inline">\(z\)</span> across all plots, and axis labels.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Box GEP, Hunter WG, Hunter JS (2005). <em>Statistics for
Experimenters: An Introduction to Design, Data Analysis, and Model
Building</em>. 2nd edition. John Wiley &amp; Sons, New York.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russell Lenth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
